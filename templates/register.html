<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>Register</title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
        rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href="{% static 'assets/vendor/aos/aos.css' %}" rel="stylesheet">
    <link href="{% static 'assets/vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'assets/vendor/bootstrap-icons/bootstrap-icons.css' %}" rel="stylesheet">
    <link href="{% static 'assets/vendor/boxicons/css/boxicons.min.css' %}" rel="stylesheet">
    <link href="{% static 'assets/vendor/glightbox/css/glightbox.min.css' %}" rel="stylesheet">
    <link href="{% static 'assets/vendor/swiper/swiper-bundle.min.css' %}" rel="stylesheet">

    <!-- Template Main CSS File -->
    <link href="{% static 'assets/css/styles.css' %}" rel="stylesheet">

</head>

<body>

    <!-- ======= Header ======= -->
    <header id="header" class="d-flex align-items-center">
        <div class="container d-flex align-items-center justify-content-between">

            <h1 class="logo"><a href="/">FAB LAB RIT</a></h1>

            <nav id="navbar" class="navbar">
                <ul>
                    <li><a class="nav-link scrollto" href="/">Home</a></li>
                    <li><a class="nav-link scrollto" href="#">Services</a></li>
                    <li><a class="nav-link scrolito" href="{% url 'machines' %}">Machines</a></li>
                    <li><a class="nav-link scrollto" href="{% url 'gallery' %}">Gallery</a></li>
                    <li><a class="nav-link scrollto" href="#">Team</a></li>
                    <li><a class="nav-link scrollto" href="#">Contact</a></li>
                    <li class="dropdown"><a href=""><span>More</span><i class="bi bi-chevron-down"></i></a>
                        <ul>
                            <li><a href="{% url 'projects' %}">Projects</a></li>
                            <li><a href="{% url 'inventory' %}">Inventory</a></li>
                            <li><a href="{% url 'programs' %}">Programs</a></li>
                        </ul>
                    </li>
                </ul>
                <i class="bi bi-list mobile-nav-toggle"></i>
            </nav><!-- .navbar -->

        </div>
    </header><!-- End Header -->

    <main id="main">

        <!-- ======= Breadcrumbs ======= -->
        <section id="breadcrumbs" class="breadcrumbs">
            <div class="container">

                <ol>
                    <li><a href="/">Home</a></li>
                    <li>Register</li>
                </ol>
                <h1>Register</h1>

            </div>
        </section><!-- End Breadcrumbs -->

        <section id="" class="">
            <div class="container">

                <div class="section-title">
                    <span>Register</span>
                    <h2>Register</h2>
                </div>

                <section class="popupBody">

                    <!-- Register Form -->
                    <div class="user_register" id="user_register">
                        <form id="form" method="POST">
                            {% csrf_token %}

                            <label>First Name</label>
                            <input name="first_name" type="text" id="first_name" value="{{value.first_name}}"
                                pattern="[A-Za-z]+" title="Only letters allowed" required />
                            <br />

                            <label>Last Name</label>
                            <input name="last_name" type="text" id="last_name" value="{{value.last_name}}"
                                pattern="[A-Za-z]+" title="Only letters allowed" required />
                            <br />

                            <label>User Name</label>
                            <input name="username" type="text" id="username" value="{{value.username}}"
                                pattern="[a-zA-Z][a-zA-Z0-9]+" minlength="6"
                                title="Minimum 6 charecters,start with a letter,contains only letters & digits"
                                required />
                            <br />

                            <label>Email Address</label>
                            <input name="email" type="email" id="email" value="{{value.email}}"
                                pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" title="Enter a valid email address"
                                required />
                            <br />

                            <label>Password</label>
                            <input name="password" type="password" id="password" minlength="8"
                                title="Minimum 8 charecters"
                                required />
                            <br />

                            <label>Confirm Password</label>
                            <input name="conf_password" type="password" id="conf_password" minlength="8"
                                title="Minimum 8 charecters"
                                required />
                            <br />

                            <div class="action_btns">
                                <div class="one_half"><button type="submit" class="btn btn_red" id="btnSubmit">Register</button></div>
                            </div>
                        </form>
                    </div>

                </section>


            </div>
        </section>

    </main><!-- End #main -->

    <!-- ======= Footer ======= -->
    {% include 'footer.html' %}
    <!-- End Footer -->

    <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
            class="bi bi-arrow-up-short"></i></a>
    <div id="preloader"></div>

    <!-- Vendor JS Files -->
    <script src="{% static 'assets/vendor/aos/aos.js' %}"></script>
    <script src="{% static 'assets/vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'assets/vendor/glightbox/js/glightbox.min.js' %}"></script>
    <script src="{% static 'assets/vendor/isotope-layout/isotope.pkgd.min.js' %}"></script>
    <script src="{% static 'assets/vendor/swiper/swiper-bundle.min.js' %}"></script>
    <script src="{% static 'assets/vendor/php-email-form/validate.js' %}"></script>

    <script src="{% static 'assets/vendor/jquery/jquery.min.js' %}"></script>

    <!-- Template Main JS File -->
    <script src="{% static 'assets/js/main_static.js' %}"></script>

    
    <script>
        var form=document.getElementById('form')
        form.addEventListener('submit',async function(e){
            e.preventDefault()

            var first_name=document.getElementById('first_name').value
            var last_name=document.getElementById('last_name').value
            var email=document.getElementById('email').value
            var username=document.getElementById('username').value
            var password=document.getElementById('password').value
            var conf_password=document.getElementById('conf_password').value

            //csrftoken
            function getCookie(name) {
                var cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    var cookies = document.cookie.split(';');
                    for (var i = 0; i < cookies.length; i++) {
                        var cookie = cookies[i].trim();
                        // Does this cookie string begin with the name we want?
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
            const csrftoken = getCookie('csrftoken');

            let response = await fetch('UserRegisterapi',{
                method:'POST',
                body:JSON.stringify({
                    first_name:first_name,
                    last_name:last_name,
                    email:email,
                    username:username,
                    password:password,
                    conf_password:conf_password
                }),
                headers:{
                    "Content-Type":"application/json; charset=UTF-8",
                    "X-CSRFToken":csrftoken,
                }
            })

            let text = await response.text();
            if(text=='{"username":["A user with that username already exists."]}')
            {
                alert("A User with that username already exists");
            }
            else if(text=='{"password":"Password does not match"}')
            {
                alert("Password does not Match");
            }
            else if(text=='{"email":"A user with the same email already exists"}')
            {
                alert("A user with the same email already exists")
            }
            else
            {
                window.location='login'
            }
            
            
        })
    </script>

</body>

</html>